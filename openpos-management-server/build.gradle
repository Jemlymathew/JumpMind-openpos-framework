/*
buildscript {
    repositories {
        mavenCentral()
    }
}
*/
plugins {
    // Apply the java plugin to add support for Java
    id 'java'
    
//    id 'com.gradle.build-scan' version '1.16'
    id 'org.springframework.boot' version '2.1.3.RELEASE'
    id 'io.spring.dependency-management' version '1.0.8.RELEASE'
}
repositories {
    mavenCentral()
}


apply from: '../openpos-gradle/src/main/resources/java.gradle'
// apply from: '../openpos-gradle/src/main/resources/openpos.gradle'

configurations {
    all {
        exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
        exclude group: 'org.springframework.boot', module: 'spring-boot-starter-tomcat'
        
    }
}

dependencies {
    // Fixes warnings in eclipse
    compile "org.springframework.boot:spring-boot-configuration-processor"
    
    compile project(":openpos-util")
    
    implementation("org.springframework.boot:spring-boot-dependencies:$springBootVersion") {
//        exclude module: 'spring-boot-starter-logging'
    }
    implementation('org.springframework.boot:spring-boot-starter-web') {
//        exclude module: 'spring-boot-starter-logging'
    }
    implementation('org.springframework.boot:spring-boot-starter-jetty') {
//        exclude module: 'spring-boot-starter-logging'
    }
    
    implementation("org.codehaus.groovy:groovy:$groovyVersion")
    implementation("org.codehaus.groovy:groovy-jsr223:$groovyVersion")
    implementation("org.codehaus.groovy:groovy-ant:$groovyVersion")
    
//    compile 'org.springframework.boot:spring-boot-starter-log4j2'
    
    // Use JUnit test framework
    // testCompile 'junit:junit:4.12'
    testImplementation ('org.springframework.boot:spring-boot-starter-test')  {
//        exclude module: 'spring-boot-starter-logging'
    }
}

test {
    filter {
        includeTestsMatching 'org.jumpmind.pos.management.*'
    }
}

// To launch local:
// java -Dloader.path=./src/test/resources -Dspring.profiles.active=bltest -jar build/libs/openpos-management-server-0.4.6-SNAPSHOT.jar
bootJar {
    mainClassName = 'org.jumpmind.pos.management.OpenposManagementServer'
    manifest {
        attributes 'Main-Class': 'org.springframework.boot.loader.PropertiesLauncher'
    }
}

task bootRunRetailer(type: org.springframework.boot.gradle.tasks.run.BootRun) {
    doFirst() {
        main = bootJar.mainClassName
        classpath = sourceSets.main.runtimeClasspath
        systemProperty 'spring.profiles.active', 'bltest'
    }

}
/*
buildScan {
    
    // always accept the terms of service
    termsOfServiceUrl = 'https://gradle.com/terms-of-service'
    termsOfServiceAgree = 'yes'
    
    // always publish a build scan
    publishAlways()
}
*/